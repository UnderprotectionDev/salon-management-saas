# File Hierarchy & Project Structure

> **Document Version:** 1.0.0  
> **Last Updated:** 2025-02-06  
> **Status:** Active Development

## Overview

This document provides a comprehensive overview of the project's file structure, explaining the purpose and organization of each major directory and file. The architecture follows Next.js 15+ App Router conventions with Convex backend integration.

---

## Root Structure

```
salon-management-saas/
├── .agents/                # AI agent configurations
├── .claude/                # Claude AI context files
├── .next/                  # Next.js build output (auto-generated)
├── .opencode/              # OpenCode configurations
├── convex/                 # Backend (Convex functions, schema, auth)
├── docs/                   # Project documentation
├── node_modules/           # Dependencies (auto-generated)
├── public/                 # Static assets
├── src/                    # Frontend source code
├── .gitignore              # Git ignore rules
├── CLAUDE.md               # Claude Code assistant guide
├── README.md               # Project overview & setup
├── biome.json              # Biome linter/formatter config
├── bun.lock                # Bun lockfile
├── components.json         # shadcn/ui configuration
├── next-env.d.ts           # Next.js TypeScript declarations
├── next.config.ts          # Next.js configuration
├── package.json            # Dependencies & scripts
├── postcss.config.mjs      # PostCSS configuration
├── tsconfig.json           # TypeScript configuration
└── tsconfig.tsbuildinfo    # TypeScript build cache
```

---

## `/convex` - Backend Layer

All backend logic, database schema, authentication, and server-side functions.

```
convex/
├── _generated/             # Auto-generated by Convex (DO NOT EDIT)
│   ├── api.d.ts           # API type definitions
│   ├── api.js             # API runtime code
│   ├── dataModel.d.ts     # Database model types
│   └── server.d.ts        # Server function types
│
├── betterAuth/            # Better Auth Convex component
│   ├── schema.ts          # Auth tables schema (auto-generated)
│   └── component/         # Auth component internals
│
├── lib/                   # Shared backend utilities
│   ├── audit.ts           # Audit logging helpers
│   ├── functions.ts       # Custom query/mutation wrappers (RLS)
│   ├── rateLimits.ts      # Rate limiting utilities
│   ├── relationships.ts   # Database relationship helpers
│   ├── rls.ts             # Row-level security helpers
│   └── validators.ts      # Convex return validators
│
├── auth.config.ts         # Better Auth configuration
├── auth.ts                # Auth instance & options
├── convex.config.ts       # Convex deployment config
├── files.ts               # File storage queries/mutations
├── http.ts                # HTTP routes (auth endpoints)
├── invitations.ts         # Staff invitation management
├── members.ts             # Organization member management
├── organizations.ts       # Organization CRUD operations
├── schema.ts              # Database schema definition
└── staff.ts               # Staff profile queries/mutations
```

### Key Files

| File | Purpose |
|------|---------|
| `schema.ts` | Defines all database tables (organizations, staff, members, etc.) |
| `lib/functions.ts` | Custom wrappers: `orgQuery`, `adminMutation`, etc. |
| `auth.ts` | Better Auth configuration & Convex adapter |
| `http.ts` | HTTP router with auth route registration |
| `lib/validators.ts` | Reusable return type validators |
| `lib/audit.ts` | Audit trail creation helpers |
| `lib/rls.ts` | Row-level security enforcement |

---

## `/src` - Frontend Layer

All client-side code including pages, components, hooks, and utilities.

```
src/
├── app/                   # Next.js App Router pages
│   ├── (auth)/            # Auth pages (route group, no URL segment)
│   │   ├── sign-in/       # Sign-in page
│   │   │   └── page.tsx
│   │   └── layout.tsx     # Auth layout (minimal, no sidebar)
│   │
│   ├── [slug]/            # Multi-tenant routes (org slug in URL)
│   │   ├── dashboard/     # Dashboard page
│   │   │   └── page.tsx
│   │   ├── settings/      # Organization settings
│   │   │   └── page.tsx
│   │   ├── staff/         # Staff management
│   │   │   ├── [id]/      # Staff detail/edit pages
│   │   │   └── page.tsx   # Staff list page
│   │   ├── error.tsx      # Error boundary
│   │   ├── layout.tsx     # Org layout (sidebar, header)
│   │   └── not-found.tsx  # 404 page
│   │
│   ├── api/               # API routes (if needed)
│   ├── dashboard/         # Dashboard redirect logic
│   │   └── page.tsx       # Redirects to active org
│   ├── onboarding/        # First-time user flow
│   │   └── page.tsx       # Organization creation wizard
│   │
│   ├── favicon.ico        # Site favicon
│   ├── globals.css        # Global styles & Tailwind imports
│   ├── layout.tsx         # Root layout (providers, fonts)
│   ├── page.tsx           # Landing page
│   └── tw-animate.css     # Tailwind animation utilities
│
├── components/            # Reusable components
│   ├── business-hours/    # Business hours editor components
│   │   ├── business-hours-editor.tsx
│   │   └── day-row.tsx
│   ├── logo-upload/       # Logo upload widget
│   │   └── logo-upload.tsx
│   └── ui/                # shadcn/ui components (56+ components)
│       ├── button.tsx
│       ├── dialog.tsx
│       ├── form.tsx
│       ├── input.tsx
│       ├── select.tsx
│       └── ... (50+ more)
│
├── hooks/                 # Custom React hooks
│   └── use-mobile.ts      # Mobile viewport detection
│
├── lib/                   # Client-side utilities
│   ├── auth-client.ts     # Client-side auth hooks (authClient)
│   ├── auth-server.ts     # Server-side auth helpers (SSR)
│   └── utils.ts           # Utility functions (cn, etc.)
│
├── modules/               # Feature modules (domain-driven)
│   ├── auth/              # Authentication module
│   │   ├── components/    # Auth-specific components
│   │   ├── layouts/       # Auth page layouts
│   │   ├── views/         # Auth page views
│   │   └── index.ts       # Public exports
│   │
│   ├── convex/            # Convex integration
│   │   └── ConvexClientProvider.tsx
│   │
│   ├── organization/      # Organization management
│   │   ├── components/    # OrganizationSwitcher, InvitationBanner
│   │   ├── providers/     # OrganizationProvider (context)
│   │   └── index.ts       # Hooks: useOrganization, useActiveOrg
│   │
│   ├── settings/          # Settings module
│   │   ├── components/    # Settings forms & sub-pages
│   │   └── index.ts
│   │
│   └── staff/             # Staff management module
│       ├── components/    # AddStaffDialog, StaffTable, etc.
│       └── index.ts
│
└── middleware.ts          # Next.js middleware (auth protection)
```

### Key Files

| File | Purpose |
|------|---------|
| `app/layout.tsx` | Root layout with ConvexClientProvider, fonts |
| `middleware.ts` | Route protection & auth checks |
| `lib/auth-client.ts` | Client-side auth hooks (`useSession`, `signIn`) |
| `lib/auth-server.ts` | Server-side auth helpers (for RSC) |
| `modules/organization/index.ts` | Organization hooks & context |
| `app/[slug]/layout.tsx` | Org-scoped layout with sidebar |
| `app/onboarding/page.tsx` | New user org creation flow |

---

## `/docs` - Documentation

Project documentation including PRD, feature specs, and technical docs.

```
docs/
└── prd/                           # Product Requirements Document
    ├── 01-product-overview.md     # Vision, goals, personas
    ├── 02-user-stories.md         # User stories by persona
    │
    ├── 03-features/               # Feature specifications
    │   ├── admin-dashboard.md     # Admin panel & analytics
    │   ├── core-booking.md        # Appointment booking engine
    │   ├── customer-portal.md     # Customer self-service
    │   ├── products-inventory.md  # Product catalog & inventory
    │   └── staff-management.md    # Staff profiles & scheduling
    │
    ├── 04-technical/              # Technical documentation
    │   ├── architecture.md        # System design & tech stack
    │   ├── api-contracts.md       # Function signatures & types
    │   ├── convex-schema.md       # Database schema with examples
    │   ├── file-hierarchy.md      # This document
    │   └── security.md            # Security requirements
    │
    ├── 05-ux-ui/                  # UX/UI documentation
    │   ├── design-system.md       # UI tokens, components
    │   └── user-flows.md          # User flow diagrams
    │
    ├── 06-implementation-roadmap.md  # Sprint-based development plan
    │
    ├── appendix/                  # Additional resources
    │   ├── edge-cases.md          # Edge case handling
    │   ├── future-roadmap.md      # Post-MVP features
    │   └── glossary.md            # Domain terminology
    │
    └── README.md                  # PRD navigation & overview
```

---

## `/public` - Static Assets

Static files served directly by Next.js (images, fonts, etc.).

```
public/
├── fonts/              # Custom fonts (if any)
├── images/             # Static images
└── ...                 # Other static assets
```

---

## Configuration Files

### Root-Level Configs

| File | Purpose |
|------|---------|
| `package.json` | Dependencies, scripts, Bun workspace config |
| `tsconfig.json` | TypeScript compiler options & path aliases |
| `next.config.ts` | Next.js framework configuration |
| `biome.json` | Biome linter/formatter rules |
| `components.json` | shadcn/ui component generator config |
| `postcss.config.mjs` | PostCSS plugins (Tailwind CSS v4) |
| `.gitignore` | Git ignore patterns |

### Key Config Highlights

```json
// tsconfig.json - Path aliases
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}
```

```json
// components.json - shadcn/ui config
{
  "style": "new-york",
  "tailwind": {
    "cssVariables": true
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils"
  }
}
```

---

## Route Structure

### App Router Routes

| Route | File Path | Description |
|-------|-----------|-------------|
| `/` | `src/app/page.tsx` | Landing page |
| `/sign-in` | `src/app/(auth)/sign-in/page.tsx` | Sign-in page |
| `/onboarding` | `src/app/onboarding/page.tsx` | Org creation wizard |
| `/dashboard` | `src/app/dashboard/page.tsx` | Redirects to active org |
| `/:slug/dashboard` | `src/app/[slug]/dashboard/page.tsx` | Org dashboard |
| `/:slug/settings` | `src/app/[slug]/settings/page.tsx` | Org settings |
| `/:slug/staff` | `src/app/[slug]/staff/page.tsx` | Staff list |
| `/:slug/staff/:id` | `src/app/[slug]/staff/[id]/page.tsx` | Staff detail/edit |

### Route Groups

- `(auth)/` — Route group (no URL segment). Used for auth pages with minimal layout.
- `[slug]/` — Dynamic segment for organization. All org-scoped pages use this prefix.

---

## Module Organization

### Domain-Driven Modules (`src/modules/`)

Each module follows this structure:

```
modules/[feature]/
├── components/        # Feature-specific components
├── hooks/             # Feature-specific hooks (optional)
├── types/             # Feature-specific types (optional)
├── utils/             # Feature-specific utilities (optional)
└── index.ts           # Public API (exports)
```

### Module Responsibilities

| Module | Responsibility |
|--------|----------------|
| `auth/` | Authentication UI, layouts, views |
| `convex/` | Convex client provider & setup |
| `organization/` | Org context, switcher, invitation handling |
| `settings/` | Settings forms & sub-pages |
| `staff/` | Staff management components & dialogs |

---

## Naming Conventions

### File Naming

- **Pages:** `page.tsx` (App Router convention)
- **Layouts:** `layout.tsx` (App Router convention)
- **Components:** `kebab-case.tsx` (e.g., `organization-switcher.tsx`)
- **Utilities:** `kebab-case.ts` (e.g., `auth-client.ts`)
- **Convex functions:** `camelCase.ts` (e.g., `organizations.ts`)

### Component Naming

- **React Components:** PascalCase (e.g., `OrganizationSwitcher`)
- **Hooks:** camelCase with `use` prefix (e.g., `useOrganization`)
- **Utilities:** camelCase (e.g., `cn`, `getToken`)

### Convex Function Naming

- **Queries:** `get*`, `list*` (e.g., `getOrganization`, `listStaff`)
- **Mutations:** action verbs (e.g., `createOrganization`, `updateStaff`)
- **Actions:** `*Action` suffix if needed (e.g., `sendEmailAction`)

---

## Import Paths

### Path Aliases

```typescript
// Configured in tsconfig.json
import { Button } from "@/components/ui/button"
import { cn } from "@/lib/utils"
import { useOrganization } from "@/modules/organization"
import { api } from "@/convex/_generated/api"
```

### Import Order (Biome Auto-Sorted)

1. External dependencies (React, Next.js, etc.)
2. Internal absolute imports (`@/*`)
3. Relative imports (`./`, `../`)
4. Type imports (if separate)

---

## File Size Guidelines

### Component Files

- **Simple components:** < 100 lines
- **Complex components:** 100-300 lines
- **Page components:** 100-400 lines
- **If larger:** Consider splitting into sub-components

### Convex Function Files

- **Single-table CRUD:** 200-500 lines
- **Complex logic:** Split into multiple functions
- **Shared logic:** Extract to `convex/lib/`

---

## Code Organization Principles

### 1. Colocation

Keep related files close together:
```
src/modules/staff/
├── components/
│   ├── add-staff-dialog.tsx
│   ├── staff-table.tsx
│   └── staff-form.tsx
└── index.ts
```

### 2. Feature-Based Structure

Organize by feature/domain, not by technical layer:
- ✅ `modules/staff/`, `modules/organization/`
- ❌ `components/`, `hooks/`, `utils/` (global only)

### 3. Single Responsibility

Each file should have a clear, single purpose:
- ✅ `add-staff-dialog.tsx` — Add staff dialog only
- ❌ `staff-components.tsx` — Multiple unrelated components

### 4. Public API via `index.ts`

Export public API from each module:
```typescript
// modules/organization/index.ts
export { OrganizationProvider } from "./providers/organization-provider"
export { useOrganization } from "./providers/organization-provider"
export { OrganizationSwitcher } from "./components/organization-switcher"
```

---

## Build Artifacts (Git-Ignored)

These directories are auto-generated and should never be committed:

```
.next/                  # Next.js build output
node_modules/           # Dependencies
convex/_generated/      # Convex generated types
tsconfig.tsbuildinfo    # TypeScript build cache
.turbo/                 # Turbo cache (if using Turborepo)
```

---

## Development Workflow

### 1. Start Development Servers

```bash
# Terminal 1: Next.js dev server
bun run dev

# Terminal 2: Convex backend + type generation
bunx convex dev
```

### 2. Add New Feature

1. Create module directory: `src/modules/[feature]/`
2. Add Convex functions: `convex/[feature].ts`
3. Add schema changes: `convex/schema.ts`
4. Run `bunx convex dev` to generate types
5. Create components: `src/modules/[feature]/components/`
6. Export public API: `src/modules/[feature]/index.ts`

### 3. Add shadcn/ui Component

```bash
bunx shadcn@latest add [component-name]
# Example: bunx shadcn@latest add dialog
```

### 4. Code Quality

```bash
bun run lint      # Check for issues
bun run format    # Auto-fix formatting
```

---

## Best Practices

### ✅ Do

- Use path aliases (`@/*`) for imports
- Keep components small and focused
- Export public API via `index.ts`
- Use Convex custom function wrappers (`orgQuery`, `adminMutation`)
- Follow naming conventions
- Colocate related files

### ❌ Don't

- Edit files in `convex/_generated/` or `.next/`
- Hardcode API URLs or secrets
- Create deep component nesting (> 3 levels)
- Mix business logic with UI components
- Commit `node_modules/` or build artifacts
- Use `any` type in TypeScript

---

## Related Documents

- [Architecture](./architecture.md) - System design & tech stack
- [Convex Schema](./convex-schema.md) - Database schema details
- [API Contracts](./api-contracts.md) - Function signatures
- [CLAUDE.md](../../../CLAUDE.md) - Development guide for Claude Code

---

## Changelog

| Version | Date | Changes |
|---------|------|---------|
| 1.0.0 | 2025-02-06 | Initial file hierarchy documentation |

---

**Note:** This document is auto-updated as the project structure evolves. Last sync: Sprint 1.5 (In Progress).
